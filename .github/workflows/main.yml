# This is a basic workflow to help you get started with Actions

name: Blob storage website CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
jobs:
  builds:
     runs-on: ubuntu
     steps:
     - uses: actions/checkout@v2
     - uses: actions/login@v1
       with: 
           creds: ${{ secrets.AZURE_CREDENTIALS }}
           
     - name: Upload to blob storage
       uses: azure/CLI@v1
       with:
         inlineScript: |
             az storage blob upload-batch --account-name cloudresumeoyvind --auth-mode key -d '$web' -s .
     - name: Purge CDN endpoint
       uses: azure/CLI@v1
       with:
         inlineScript: |
            az cdn endpoint purge --content-paths  "/*" --profile-name "cdncloudresume" --name "finsrudcloud" --resource-group "CloudResume"
      # Azure logout
     - name: logout
       run: |
            az logout
       if: always()
